<!DOCTYPE html>
<html>

<head>
  <title>Google Places Autocomplete</title>
  <script type="text/javascript" src="//js.jotform.com/JotFormCustomWidget.min.js"></script>

</head>

<body>
  <input id="autocomplete" placeholder="Enter your address" type="text" />
  <script>

function googleReady () {
        var autocomplete = new google.maps.places.Autocomplete(
          document.getElementById("autocomplete"),
          {
            componentRestrictions: { country: "nz" },
          }
        );

        autocomplete.addListener("place_changed", function () {
          var place = autocomplete.getPlace();
          var address = place.formatted_address;
          var lat = place.geometry.location.lat();
          var lng = place.geometry.location.lng();
          window.autocompleteValid = true;
          window.autocompleteValue = JSON.stringify({ address, lat, lng })
          console.log('set return', autocompleteValue)
        });

      }

    JFCustomWidget.subscribe("ready", function (msg) {
      console.log('ready!', msg)

      window.autocompleteValid = false;
      window.autocompleteValue = ''

      var placesApiKey = JFCustomWidget.getWidgetSetting('placesApiKey');
      var script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=' + placesApiKey + '&libraries=places&callback=googleReady';
      script.async = false;
      document.head.appendChild(script);





      JFCustomWidget.subscribe("submit", function () {
        //prepare your data
        var data = { valid: false };
        if (window.autocompleteValid) {
          data.valid = true
          data.value = window.autocompleteValue
        }

        JFCustomWidget.sendResult(data);
      });




    })

  </script>
</body>

</html>
