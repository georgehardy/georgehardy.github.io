<!DOCTYPE html>
<html>

<head>
  <title>Address autocomplete</title>
  <script type="text/javascript" src="//js.jotform.com/JotFormCustomWidget.min.js"></script>

</head>

<body>
  <input id="autocomplete" placeholder="Enter your address" type="text" style="width:95%" />
  <script>

    function googleReady() {
      var autocomplete = new google.maps.places.Autocomplete(
        document.getElementById("autocomplete"),
        {
          componentRestrictions: { country: "nz" },
        }
      );

      autocomplete.addListener("place_changed", function () {
        var place = autocomplete.getPlace();
        var address = place.formatted_address;
        var lat = place.geometry.location.lat();
        var lng = place.geometry.location.lng();
        window.autocompleteValid = true;
        window.autocompleteValue = 'lat: ' + lat + ' lng: ' + lng + ' address: ' + address;
        console.log(window.autocompleteValue)
        JFCustomWidget.sendData(window.autocompleteValue)
      });

    }

    JFCustomWidget.subscribe("ready", function (msg) {
      window.autocompleteValid = false;
      window.autocompleteValue = ''
      var placesApiKey = JFCustomWidget.getWidgetSetting('placesApiKey');
      var script = document.createElement('script');
      script.src = 'https://maps.googleapis.com/maps/api/js?key=' + placesApiKey + '&libraries=places&callback=googleReady';
      script.async = false;
      document.head.appendChild(script);

    })

    JFCustomWidget.subscribe("submit", function () {
      var data = { valid: false };
      if (window.autocompleteValid) {
        data.valid = true
        data.value = window.autocompleteValue
      }
      JFCustomWidget.sendSubmit(data);
    });

  </script>
</body>

</html>
